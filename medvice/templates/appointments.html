<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Randevu Al - Medvice</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 100%;
        margin: 0;
        background: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        padding: 20px 25px;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
      }

      .header-title {
        flex: 1;
        font-size: 18px;
        font-weight: 600;
      }

      .content {
        flex: 1;
        padding: 25px;
        overflow-y: auto;
      }

      .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 25px;
      }

      .step {
        display: flex;
        align-items: center;
        margin: 0 10px;
      }

      .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
        margin-right: 8px;
      }

      .step.active .step-number {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        color: white;
      }

      .step.completed .step-number {
        background: #27ae60;
        color: white;
      }

      .step.inactive .step-number {
        background: #e9ecef;
        color: #666;
      }

      .step-text {
        font-size: 12px;
        color: #666;
      }

      .step.active .step-text {
        color: #333;
        font-weight: 600;
      }

      .section {
        display: none;
      }

      .section.active {
        display: block;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }

      /* Poliklinik Se√ßimi */
      .department-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .department-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .department-card:hover {
        border-color: #00d2ff;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .department-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .department-icon {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .department-name {
        font-size: 13px;
        font-weight: 600;
        color: #333;
      }

      /* Hastane Se√ßimi */
      .hospital-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .hospital-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .hospital-card:hover,
      .hospital-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .hospital-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 12px;
      }

      .hospital-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
      }

      .hospital-info h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
        color: #333;
        font-weight: 600;
      }

      .hospital-info p {
        margin: 0;
        font-size: 13px;
        color: #666;
      }

      .hospital-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 12px;
      }

      .detail-item {
        text-align: center;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      .detail-value {
        font-size: 12px;
        font-weight: 600;
        color: #333;
      }

      .detail-label {
        font-size: 10px;
        color: #666;
        margin-top: 2px;
      }

      /* Doktor Se√ßimi */
      .doctor-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .doctor-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .doctor-card:hover,
      .doctor-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .doctor-header {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .doctor-photo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: white;
      }

      .doctor-info h5 {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #333;
        font-weight: 600;
      }

      .doctor-info p {
        margin: 0;
        font-size: 12px;
        color: #666;
      }

      /* Tarih ve Saat Se√ßimi */
      .date-picker {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 20px;
      }

      .date-item {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 10px 5px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .date-item:hover,
      .date-item.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .date-item.disabled {
        background: #f8f9fa;
        color: #ccc;
        cursor: not-allowed;
      }

      .date-day {
        font-size: 11px;
        color: #666;
        margin-bottom: 3px;
      }

      .date-number {
        font-size: 14px;
        font-weight: 600;
        color: #333;
      }

      .time-slots {
        display: none; /* Ba≈ülangƒ±√ßta gizli */
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 10px;
        margin-bottom: 25px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .time-slots.show {
        display: grid;
      }

      .time-slot {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 13px;
        font-weight: 500;
      }

      .time-slot:hover,
      .time-slot.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .time-slot.unavailable {
        background: #f8f9fa;
        color: #ccc;
        cursor: not-allowed;
      }

      /* Navigation Buttons */
      .navigation {
        display: flex;
        gap: 15px;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .nav-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-prev {
        background: #f8f9fa;
        color: #666;
        border: 1px solid #e9ecef;
      }

      .btn-next {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        color: white;
      }

      .btn-next:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3);
      }

      .btn-prev:hover {
        background: #e9ecef;
      }

      /* √ñzet Sayfasƒ± */
      .summary-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #00d2ff;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #dee2e6;
      }

      .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .summary-label {
        font-weight: 600;
        color: #333;
      }

      .summary-value {
        color: #666;
        text-align: right;
      }

      .confirm-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .confirm-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="back-btn" onclick="history.back()">‚Üê</button>
        <div class="header-title">Randevu Al</div>
        <div>üìÖ</div>
      </div>

      <div class="content">
        <!-- Adƒ±m G√∂stergesi -->
        <div class="step-indicator">
          <div class="step active" id="step1">
            <div class="step-number">1</div>
            <div class="step-text">Poliklinik</div>
          </div>
          <div class="step inactive" id="step2">
            <div class="step-number">2</div>
            <div class="step-text">Hastane</div>
          </div>
          <div class="step inactive" id="step3">
            <div class="step-number">3</div>
            <div class="step-text">Doktor</div>
          </div>
          <div class="step inactive" id="step4">
            <div class="step-number">4</div>
            <div class="step-text">Tarih & Saat</div>
          </div>
          <div class="step inactive" id="step5">
            <div class="step-number">5</div>
            <div class="step-text">Onay</div>
          </div>
        </div>

        <!-- Poliklinik Se√ßimi -->
        <div class="section active" id="section1">
          <div class="section-title">
            Hangi poliklinikten randevu almak istiyorsunuz?
          </div>
          <div class="department-grid" id="departmentGrid"></div>
        </div>

        <!-- Hastane Se√ßimi -->
        <div class="section" id="section2">
          <div class="section-title">Hastane se√ßiniz</div>
          <div class="hospital-list" id="hospitalList"></div>
        </div>

        <!-- Doktor Se√ßimi -->
        <div class="section" id="section3">
          <div class="section-title">Doktor se√ßiniz</div>
          <div class="doctor-list" id="doctorList"></div>
        </div>

        <!-- Tarih ve Saat Se√ßimi -->
        <div class="section" id="section4">
          <div class="section-title">Tarih ve saat se√ßiniz</div>
          <div class="date-picker" id="datePicker"></div>
          <div class="time-slots" id="timeSlots"></div>
        </div>

        <!-- √ñzet ve Onay -->
        <div class="section" id="section5">
          <div class="section-title">Randevu Bilgilerinizi Onaylayƒ±n</div>
          <div class="summary-card" id="summaryCard"></div>
          <button class="confirm-btn" onclick="confirmAppointment()">
            ‚úÖ Randevuyu Onayla
          </button>
        </div>

        <!-- Navigation -->
        <div class="navigation">
          <button
            class="nav-btn btn-prev"
            onclick="previousStep()"
            id="prevBtn"
            style="display: none"
          >
            ‚Üê √ñnceki
          </button>
          <button class="nav-btn btn-next" onclick="nextStep()" id="nextBtn">
            Devam Et ‚Üí
          </button>
        </div>
      </div>
    </div>

    <script>
      // Mevcut script etiketinin i√ßeriƒüini ≈üununla deƒüi≈ütirin:

      let currentStep = 1;
      let selectedData = {
        department: null,
        hospital: null,
        doctor: null,
        date: null,
        time: null,
      };

      // API fonksiyonlarƒ±
      async function fetchAPI(url) {
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          console.error("API Error:", error);
          showError("Veri y√ºklenirken hata olu≈ütu");
          return null;
        }
      }

      async function postAPI(url, data) {
        try {
          const response = await fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          return await response.json();
        } catch (error) {
          console.error("API Error:", error);
          showError("ƒ∞≈ülem sƒ±rasƒ±nda hata olu≈ütu");
          return null;
        }
      }

      function showError(message) {
        alert(message);
      }

      function showLoading(container, message = "Y√ºkleniyor...") {
        container.innerHTML = `
        <div style="text-align: center; padding: 20px; color: #666;">
            <div style="font-size: 24px; margin-bottom: 10px;">‚è≥</div>
            <p>${message}</p>
        </div>
    `;
      }

      // Sayfa ba≈ülatma
      async function initializePage() {
        await loadDepartments();
      }

      // Poliklinik y√ºkleme
      async function loadDepartments() {
        const container = document.getElementById("departmentGrid");
        showLoading(container, "Poliklinikler y√ºkleniyor...");

        const departments = await fetchAPI("/api/departments");
        if (departments) {
          renderDepartments(departments);
        }
      }

      function renderDepartments(departments) {
        const container = document.getElementById("departmentGrid");
        container.innerHTML = departments
          .map(
            (dept) => `
        <div class="department-card" onclick="selectDepartment('${dept.id}', '${dept.name}')">
            <div class="department-icon">${dept.icon}</div>
            <div class="department-name">${dept.name}</div>
        </div>
    `
          )
          .join("");
      }

      function selectDepartment(id, name) {
        selectedData.department = { id, name };
        document
          .querySelectorAll(".department-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".department-card").classList.add("selected");
        document.getElementById("nextBtn").style.display = "block";
      }

      // Hastane y√ºkleme
      async function loadHospitals() {
        const container = document.getElementById("hospitalList");
        showLoading(container, "Hastaneler y√ºkleniyor...");

        const hospitals = await fetchAPI(
          `/api/hospitals/${selectedData.department.id}`
        );
        if (hospitals) {
          renderHospitals(hospitals);
        }
      }

      function renderHospitals(hospitals) {
        const container = document.getElementById("hospitalList");

        if (hospitals.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
                <div style="font-size: 48px; margin-bottom: 15px;">üè•</div>
                <h3>Bu poliklinik i√ßin hastane bulunamadƒ±</h3>
                <p>L√ºtfen ba≈üka bir poliklinik se√ßiniz.</p>
            </div>
        `;
          return;
        }

        container.innerHTML = hospitals
          .map(
            (hospital) => `
        <div class="hospital-card" onclick="selectHospital(${hospital.id}, '${hospital.name}')">
            <div class="hospital-header">
                <div class="hospital-icon">üè•</div>
                <div class="hospital-info">
                    <h4>${hospital.name}</h4>
                    <p>${hospital.location} ‚Ä¢ ${hospital.distance}</p>
                </div>
            </div>
            <div class="hospital-details">
                <div class="detail-item">
                    <div class="detail-value">${hospital.rating}</div>
                    <div class="detail-label">Deƒüerlendirme</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">${hospital.distance}</div>
                    <div class="detail-label">Mesafe</div>
                </div>
                <div class="detail-item">
                    <div class="detail-value">Mevcut</div>
                    <div class="detail-label">Randevu</div>
                </div>
            </div>
        </div>
    `
          )
          .join("");
      }

      function selectHospital(id, name) {
        selectedData.hospital = { id, name };
        document
          .querySelectorAll(".hospital-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".hospital-card").classList.add("selected");
      }

      // Doktor y√ºkleme
      async function loadDoctors() {
        const container = document.getElementById("doctorList");
        showLoading(container, "Doktorlar y√ºkleniyor...");

        const doctors = await fetchAPI(
          `/api/doctors/${selectedData.department.id}/${selectedData.hospital.id}`
        );
        if (doctors) {
          renderDoctors(doctors);
        }
      }

      function renderDoctors(doctors) {
        const container = document.getElementById("doctorList");

        if (doctors.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
                <div style="font-size: 48px; margin-bottom: 15px;">üë®‚Äç‚öïÔ∏è</div>
                <h3>Bu hastanede ${selectedData.department.name} doktoru bulunamadƒ±</h3>
                <p>L√ºtfen ba≈üka bir hastane se√ßiniz.</p>
            </div>
        `;
          return;
        }

        container.innerHTML = doctors
          .map(
            (doctor) => `
        <div class="doctor-card" onclick="selectDoctor(${doctor.id}, '${doctor.name}')">
            <div class="doctor-header">
                <div class="doctor-photo">üë®‚Äç‚öïÔ∏è</div>
                <div class="doctor-info">
                    <h5>${doctor.name}</h5>
                    <p>${doctor.experience} deneyim ‚Ä¢ ‚≠ê ${doctor.rating}</p>
                </div>
            </div>
        </div>
    `
          )
          .join("");
      }

      function selectDoctor(id, name) {
        selectedData.doctor = { id, name };
        document
          .querySelectorAll(".doctor-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".doctor-card").classList.add("selected");
      }

      // Tarih y√ºkleme
      async function loadAvailableDates() {
        const container = document.getElementById("datePicker");
        showLoading(container, "M√ºsait tarihler y√ºkleniyor...");

        const availableDates = await fetchAPI(
          `/api/available-dates/${selectedData.doctor.id}`
        );
        if (availableDates) {
          renderDatePicker(availableDates);
        }
      }

      function renderDatePicker(availableDates) {
        const container = document.getElementById("datePicker");
        const today = new Date();
        const dates = [];

        // 14 g√ºn ileriye kadar tarihler olu≈ütur
        for (let i = 1; i <= 14; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() + i);
          dates.push(date);
        }

        container.innerHTML = dates
          .map((date) => {
            const dayName = date.toLocaleDateString("tr-TR", {
              weekday: "short",
            });
            const dayNum = date.getDate();
            const dateStr = date.toISOString().split("T")[0];
            const isAvailable = availableDates.includes(dateStr);

            return `
            <div class="date-item ${isAvailable ? "" : "disabled"}" 
                 onclick="${isAvailable ? `selectDate('${dateStr}')` : ""}">
                <div class="date-day">${dayName}</div>
                <div class="date-number">${dayNum}</div>
            </div>
        `;
          })
          .join("");
      }

      async function selectDate(dateStr) {
        selectedData.date = dateStr;
        document
          .querySelectorAll(".date-item")
          .forEach((item) => item.classList.remove("selected"));
        event.target.closest(".date-item").classList.add("selected");

        // Saat slotlarƒ±nƒ± y√ºkle
        await loadAvailableTimes(dateStr);

        // Saat se√ßimi b√∂l√ºm√ºn√º g√∂ster
        const timeSlotsContainer = document.getElementById("timeSlots");
        timeSlotsContainer.style.display = "grid";
        timeSlotsContainer.scrollIntoView({
          behavior: "smooth",
          block: "nearest",
        });
      }

      // Saat y√ºkleme
      async function loadAvailableTimes(date) {
        const container = document.getElementById("timeSlots");
        showLoading(container, "M√ºsait saatler y√ºkleniyor...");

        const availableTimes = await fetchAPI(
          `/api/available-times/${selectedData.doctor.id}/${date}`
        );
        if (availableTimes) {
          renderTimeSlots(availableTimes);
        }
      }

      function renderTimeSlots(availableTimes) {
        const container = document.getElementById("timeSlots");

        // T√ºm saat aralƒ±klarƒ±
        const morningTimes = [
          "09:00",
          "09:20",
          "09:40",
          "10:00",
          "10:20",
          "10:40",
          "11:00",
          "11:20",
          "11:40",
        ];
        const afternoonTimes = [
          "13:00",
          "13:20",
          "13:40",
          "14:00",
          "14:20",
          "14:40",
          "15:00",
          "15:20",
          "15:40",
          "16:00",
          "16:20",
          "16:40",
        ];
        const allTimes = [...morningTimes, ...afternoonTimes];

        container.innerHTML = allTimes
          .map((time) => {
            const isAvailable = availableTimes.includes(time);
            return `
            <div class="time-slot ${isAvailable ? "" : "unavailable"}" 
                 onclick="${isAvailable ? `selectTime('${time}')` : ""}">
                ${time}
            </div>
        `;
          })
          .join("");
      }

      function selectTime(time) {
        selectedData.time = time;
        document
          .querySelectorAll(".time-slot")
          .forEach((slot) => slot.classList.remove("selected"));
        event.target.classList.add("selected");
      }

      function renderSummary() {
        const container = document.getElementById("summaryCard");
        const date = new Date(selectedData.date);
        const formattedDate = date.toLocaleDateString("tr-TR", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        container.innerHTML = `
        <div class="summary-item">
            <div class="summary-label">Poliklinik:</div>
            <div class="summary-value">${selectedData.department.name}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Hastane:</div>
            <div class="summary-value">${selectedData.hospital.name}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Doktor:</div>
            <div class="summary-value">${selectedData.doctor.name}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Tarih:</div>
            <div class="summary-value">${formattedDate}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Saat:</div>
            <div class="summary-value">${selectedData.time}</div>
        </div>
    `;
      }

      async function nextStep() {
        if (currentStep === 1 && !selectedData.department) {
          alert("L√ºtfen bir poliklinik se√ßiniz.");
          return;
        }
        if (currentStep === 2 && !selectedData.hospital) {
          alert("L√ºtfen bir hastane se√ßiniz.");
          return;
        }
        if (currentStep === 3 && !selectedData.doctor) {
          alert("L√ºtfen bir doktor se√ßiniz.");
          return;
        }
        if (currentStep === 4 && (!selectedData.date || !selectedData.time)) {
          alert("L√ºtfen tarih ve saat se√ßiniz.");
          return;
        }

        currentStep++;
        updateStepIndicator();
        showCurrentSection();

        // Her adƒ±mda ilgili verileri y√ºkle
        if (currentStep === 2) {
          await loadHospitals();
        } else if (currentStep === 3) {
          await loadDoctors();
        } else if (currentStep === 4) {
          await loadAvailableDates();
        } else if (currentStep === 5) {
          renderSummary();
          document.getElementById("nextBtn").style.display = "none";
        }

        // √ñnceki butonu g√∂ster
        if (currentStep > 1) {
          document.getElementById("prevBtn").style.display = "block";
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          currentStep--;
          updateStepIndicator();
          showCurrentSection();

          // Devam et butonunu tekrar g√∂ster
          document.getElementById("nextBtn").style.display = "block";

          // ƒ∞lk adƒ±mda √∂nceki butonu gizle
          if (currentStep === 1) {
            document.getElementById("prevBtn").style.display = "none";
          }
        }
      }

      function updateStepIndicator() {
        for (let i = 1; i <= 5; i++) {
          const step = document.getElementById(`step${i}`);
          if (i < currentStep) {
            step.className = "step completed";
          } else if (i === currentStep) {
            step.className = "step active";
          } else {
            step.className = "step inactive";
          }
        }
      }

      function showCurrentSection() {
        for (let i = 1; i <= 5; i++) {
          const section = document.getElementById(`section${i}`);
          if (i === currentStep) {
            section.classList.add("active");
          } else {
            section.classList.remove("active");
          }
        }
      }

      async function confirmAppointment() {
        const confirmBtn = document.querySelector(".confirm-btn");
        const originalText = confirmBtn.innerHTML;

        // Loading durumu
        confirmBtn.innerHTML = "‚è≥ Randevu kaydediliyor...";
        confirmBtn.disabled = true;

        const appointmentData = {
          patient_name: getUsername(),
          department_id: selectedData.department.id,
          hospital_id: selectedData.hospital.id,
          doctor_id: selectedData.doctor.id,
          date: selectedData.date,
          time: selectedData.time,
        };

        const result = await postAPI("/api/appointments", appointmentData);

        if (result && result.success) {
          const date = new Date(selectedData.date);
          const formattedDate = date.toLocaleDateString("tr-TR", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          const confirmMessage = `
üéâ Randevunuz ba≈üarƒ±yla alƒ±ndƒ±!

üìã Randevu Detaylarƒ±:
‚Ä¢ Poliklinik: ${selectedData.department.name}
‚Ä¢ Hastane: ${selectedData.hospital.name}
‚Ä¢ Doktor: ${selectedData.doctor.name}
‚Ä¢ Tarih: ${formattedDate}
‚Ä¢ Saat: ${selectedData.time}

üì± SMS ile randevu hatƒ±rlatmasƒ± g√∂nderilecektir.
üìß E-posta onay bilgisi iletilmi≈ütir.

Randevunuza 15 dakika √∂nce hastanede bulunmanƒ±z √∂nerilir.
        `;

          alert(confirmMessage);

          // Ba≈üarƒ± animasyonu
          confirmBtn.innerHTML = "‚úÖ Randevu Alƒ±ndƒ±!";
          confirmBtn.style.background =
            "linear-gradient(135deg, #27ae60 0%, #229954 100%)";

          // 3 saniye sonra ana sayfaya y√∂nlendir
          setTimeout(() => {
            window.location.href = "/welcome/" + getUsername();
          }, 3000);
        } else {
          // Hata durumu
          confirmBtn.innerHTML = originalText;
          confirmBtn.disabled = false;
          alert(result ? result.error : "Randevu kaydedilirken hata olu≈ütu");
        }
      }

      function getUsername() {
        // URL'den kullanƒ±cƒ± adƒ±nƒ± al
        const pathParts = window.location.pathname.split("/");
        return pathParts[pathParts.length - 1] || "user";
      }

      // Sayfa y√ºklendiƒüinde ba≈ülat
      document.addEventListener("DOMContentLoaded", function () {
        initializePage();

        // Kartlara animasyon ekle
        setTimeout(() => {
          const cards = document.querySelectorAll(".department-card");
          cards.forEach((card, index) => {
            card.style.opacity = "0";
            card.style.transform = "translateY(20px)";
            card.style.transition = "all 0.5s ease";

            setTimeout(() => {
              card.style.opacity = "1";
              card.style.transform = "translateY(0)";
            }, index * 100);
          });
        }, 100);
      });
    </script>
  </body>
</html>
