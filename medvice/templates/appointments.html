<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Randevu Al - Medvice</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 100%;
        margin: 0;
        background: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        padding: 20px 25px;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
      }

      .header-title {
        flex: 1;
        font-size: 18px;
        font-weight: 600;
      }

      .content {
        flex: 1;
        padding: 25px;
        overflow-y: auto;
      }

      .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 25px;
      }

      .step {
        display: flex;
        align-items: center;
        margin: 0 10px;
      }

      .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
        margin-right: 8px;
      }

      .step.active .step-number {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        color: white;
      }

      .step.completed .step-number {
        background: #27ae60;
        color: white;
      }

      .step.inactive .step-number {
        background: #e9ecef;
        color: #666;
      }

      .step-text {
        font-size: 12px;
        color: #666;
      }

      .step.active .step-text {
        color: #333;
        font-weight: 600;
      }

      .section {
        display: none;
      }

      .section.active {
        display: block;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }

      /* Poliklinik Seçimi */
      .department-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .department-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .department-card:hover {
        border-color: #00d2ff;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .department-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .department-icon {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .department-name {
        font-size: 13px;
        font-weight: 600;
        color: #333;
      }

      /* Hastane Seçimi */
      .hospital-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .hospital-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .hospital-card:hover,
      .hospital-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .hospital-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 12px;
      }

      .hospital-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
      }

      .hospital-info h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
        color: #333;
        font-weight: 600;
      }

      .hospital-info p {
        margin: 0;
        font-size: 13px;
        color: #666;
      }

      .hospital-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 12px;
      }

      .detail-item {
        text-align: center;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      .detail-value {
        font-size: 12px;
        font-weight: 600;
        color: #333;
      }

      .detail-label {
        font-size: 10px;
        color: #666;
        margin-top: 2px;
      }

      /* Doktor Seçimi */
      .doctor-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .doctor-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .doctor-card:hover,
      .doctor-card.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .doctor-header {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .doctor-photo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: white;
      }

      .doctor-info h5 {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #333;
        font-weight: 600;
      }

      .doctor-info p {
        margin: 0;
        font-size: 12px;
        color: #666;
      }

      /* Tarih ve Saat Seçimi */
      .date-picker {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 20px;
      }

      .date-item {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 10px 5px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .date-item:hover,
      .date-item.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .date-item.disabled {
        background: #f8f9fa;
        color: #ccc;
        cursor: not-allowed;
      }

      .date-day {
        font-size: 11px;
        color: #666;
        margin-bottom: 3px;
      }

      .date-number {
        font-size: 14px;
        font-weight: 600;
        color: #333;
      }

      .time-slots {
        display: none; /* Başlangıçta gizli */
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 10px;
        margin-bottom: 25px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .time-slots.show {
        display: grid;
      }

      .time-slot {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 13px;
        font-weight: 500;
      }

      .time-slot:hover,
      .time-slot.selected {
        border-color: #00d2ff;
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }

      .time-slot.unavailable {
        background: #f8f9fa;
        color: #ccc;
        cursor: not-allowed;
      }

      /* Navigation Buttons */
      .navigation {
        display: flex;
        gap: 15px;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .nav-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-prev {
        background: #f8f9fa;
        color: #666;
        border: 1px solid #e9ecef;
      }

      .btn-next {
        background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        color: white;
      }

      .btn-next:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3);
      }

      .btn-prev:hover {
        background: #e9ecef;
      }

      /* Özet Sayfası */
      .summary-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #00d2ff;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #dee2e6;
      }

      .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .summary-label {
        font-weight: 600;
        color: #333;
      }

      .summary-value {
        color: #666;
        text-align: right;
      }

      .confirm-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .confirm-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="back-btn" onclick="history.back()">←</button>
        <div class="header-title">Randevu Al</div>
        <div>📅</div>
      </div>

      <div class="content">
        <!-- Adım Göstergesi -->
        <div class="step-indicator">
          <div class="step active" id="step1">
            <div class="step-number">1</div>
            <div class="step-text">Poliklinik</div>
          </div>
          <div class="step inactive" id="step2">
            <div class="step-number">2</div>
            <div class="step-text">Hastane</div>
          </div>
          <div class="step inactive" id="step3">
            <div class="step-number">3</div>
            <div class="step-text">Doktor</div>
          </div>
          <div class="step inactive" id="step4">
            <div class="step-number">4</div>
            <div class="step-text">Tarih & Saat</div>
          </div>
          <div class="step inactive" id="step5">
            <div class="step-number">5</div>
            <div class="step-text">Onay</div>
          </div>
        </div>

        <!-- Poliklinik Seçimi -->
        <div class="section active" id="section1">
          <div class="section-title">
            Hangi poliklinikten randevu almak istiyorsunuz?
          </div>
          <div class="department-grid" id="departmentGrid"></div>
        </div>

        <!-- Hastane Seçimi -->
        <div class="section" id="section2">
          <div class="section-title">Hastane seçiniz</div>
          <div class="hospital-list" id="hospitalList"></div>
        </div>

        <!-- Doktor Seçimi -->
        <div class="section" id="section3">
          <div class="section-title">Doktor seçiniz</div>
          <div class="doctor-list" id="doctorList"></div>
        </div>

        <!-- Tarih ve Saat Seçimi -->
        <div class="section" id="section4">
          <div class="section-title">Tarih ve saat seçiniz</div>
          <div class="date-picker" id="datePicker"></div>
          <div class="time-slots" id="timeSlots"></div>
        </div>

        <!-- Özet ve Onay -->
        <div class="section" id="section5">
          <div class="section-title">Randevu Bilgilerinizi Onaylayın</div>
          <div class="summary-card" id="summaryCard"></div>
          <button class="confirm-btn" onclick="confirmAppointment()">
            ✅ Randevuyu Onayla
          </button>
        </div>

        <!-- Navigation -->
        <div class="navigation">
          <button
            class="nav-btn btn-prev"
            onclick="previousStep()"
            id="prevBtn"
            style="display: none"
          >
            ← Önceki
          </button>
          <button class="nav-btn btn-next" onclick="nextStep()" id="nextBtn">
            Devam Et →
          </button>
        </div>
      </div>
    </div>

    <script>
      let selectedData = {
        department: { id: null, name: null },
        hospital: { id: null, name: null },
        doctor: { id: null, name: null },
        date: null,
        time: null,
      };

      async function initializePage() {
        await renderDepartments();
      }

      async function renderDepartments() {
        const container = document.getElementById("departmentGrid");

        // Loading göster
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Poliklinikler yükleniyor...</div>';

        try {
          const response = await fetch("/api/departments");
          const departments = await response.json();

          container.innerHTML = departments
            .map(
              (dept) => `
                        <div class="department-card" onclick="selectDepartment(${dept.id}, '${dept.name}')">
                            <div class="department-icon">${dept.icon}</div>
                            <div class="department-name">${dept.name}</div>
                        </div>
                    `
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<div class="loading">Poliklinikler yüklenirken hata oluştu. Lütfen tekrar deneyin.</div>';
          console.error("Department loading error:", error);
        }
      }

      function selectDepartment(id, name) {
        selectedData.department = { id, name };
        document
          .querySelectorAll(".department-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".department-card").classList.add("selected");
        document.getElementById("nextBtn").style.display = "block";
      }

      async function renderHospitals() {
        const container = document.getElementById("hospitalList");

        // Loading göster
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Hastaneler yükleniyor...</div>';

        try {
          const response = await fetch(
            `/api/hospitals/${selectedData.department.id}`
          );
          const hospitals = await response.json();

          if (hospitals.length === 0) {
            container.innerHTML =
              '<div class="loading">Bu poliklinik için hastane bulunamadı.</div>';
            return;
          }

          container.innerHTML = hospitals
            .map(
              (hospital) => `
                  <div class="hospital-card" onclick="selectHospital(${hospital.id}, '${hospital.name}')">
                      <div class="hospital-header">
                          <div class="hospital-icon">🏥</div>
                          <div class="hospital-info">
                              <h4>${hospital.name}</h4>
                              <p>${hospital.location} • ${hospital.distance}</p>
                          </div>
                      </div>
                      <div class="hospital-details">
                          <div class="detail-item">
                              <div class="detail-value">${hospital.rating}</div>
                              <div class="detail-label">Değerlendirme</div>
                          </div>
                          <div class="detail-item">
                              <div class="detail-value">${hospital.distance}</div>
                              <div class="detail-label">Mesafe</div>
                          </div>
                          <div class="detail-item">
                              <div class="detail-value">Mevcut</div>
                              <div class="detail-label">Randevu</div>
                          </div>
                      </div>
                  </div>
              `
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<div class="loading">Hastaneler yüklenirken hata oluştu. Lütfen tekrar deneyin.</div>';
          console.error("Hospital loading error:", error);
        }
      }

      function selectHospital(id, name) {
        selectedData.hospital = { id: id, name: name };
        document
          .querySelectorAll(".hospital-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".hospital-card").classList.add("selected");

        // Sonraki seçimleri sıfırla
        selectedData.doctor = { id: null, name: null };
        selectedData.date = null;
        selectedData.time = null;
      }

      async function renderDoctors() {
        const container = document.getElementById("doctorList");

        // Loading göster
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Doktorlar yükleniyor...</div>';

        try {
          const response = await fetch(
            `/api/doctors/${selectedData.department.id}/${selectedData.hospital.id}`
          );
          const doctors = await response.json();

          if (doctors.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <div style="font-size: 48px; margin-bottom: 15px;">👨‍⚕️</div>
                    <h3>Bu hastane ve poliklinik için doktor bulunamadı</h3>
                    <p>Lütfen başka bir hastane seçiniz.</p>
                </div>
            `;
            return;
          }

          container.innerHTML = doctors
            .map(
              (doctor) => `
            <div class="doctor-card" onclick="selectDoctor(${doctor.id}, '${doctor.name}')">
                <div class="doctor-header">
                    <div class="doctor-photo">👨‍⚕️</div>
                    <div class="doctor-info">
                        <h5>${doctor.name}</h5>
                        <p>${doctor.experience} deneyim • ⭐ ${doctor.rating}</p>
                    </div>
                </div>
            </div>
        `
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<div class="loading">Doktorlar yüklenirken hata oluştu. Lütfen tekrar deneyin.</div>';
          console.error("Doctor loading error:", error);
        }
      }
      function selectDoctor(id, name) {
        selectedData.doctor = { id: id, name: name };
        document
          .querySelectorAll(".doctor-card")
          .forEach((card) => card.classList.remove("selected"));
        event.target.closest(".doctor-card").classList.add("selected");

        // Sonraki seçimleri sıfırla
        selectedData.date = null;
        selectedData.time = null;
      }

      function renderDatePicker() {
        const container = document.getElementById("datePicker");
        const dates = [];
        const today = new Date();

        // Bugünden itibaren 14 gün ileriye kadar tarihler
        for (let i = 1; i <= 14; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() + i);
          dates.push(date);
        }

        container.innerHTML = dates
          .map((date) => {
            const dayName = date.toLocaleDateString("tr-TR", {
              weekday: "short",
            });
            const dayNum = date.getDate();
            const monthName = date.toLocaleDateString("tr-TR", {
              month: "short",
            });

            // Pazar günleri ve bazı rastgele günleri kapalı yap
            const isSunday = date.getDay() === 0;
            const isRandomlyClosed = Math.random() < 0.15; // %15 rastgele kapalı
            const disabled = isSunday || isRandomlyClosed;

            return `
                                      <div class="date-item ${
                                        disabled ? "disabled" : ""
                                      }"
                                           onclick="${
                                             disabled
                                               ? ""
                                               : `selectDate('${
                                                   date
                                                     .toISOString()
                                                     .split("T")[0]
                                                 }')`
                                           }">
                                          <div class="date-day">${dayName}</div>
                                          <div class="date-number">${dayNum}</div>
                                          <div class="date-month" style="font-size: 10px; color: #999;">${monthName}</div>
                                      </div>
                                  `;
          })
          .join("");
      }

      async function selectDate(dateStr) {
        selectedData.date = dateStr;
        document
          .querySelectorAll(".date-item")
          .forEach((item) => item.classList.remove("selected"));
        event.target.closest(".date-item").classList.add("selected");

        // Saat seçimi bölümünü göster ve loading başlat
        const timeSlotsContainer = document.getElementById("timeSlots");
        timeSlotsContainer.style.display = "grid";
        timeSlotsContainer.innerHTML =
          '<div class="loading"><div class="spinner"></div>Müsait saatler yükleniyor...</div>';
        timeSlotsContainer.scrollIntoView({
          behavior: "smooth",
          block: "nearest",
        });

        // Tarih seçildikten sonra saat slotlarını yükle
        await renderTimeSlots();
      }

      async function renderTimeSlots() {
        const container = document.getElementById("timeSlots");

        // Loading göster
        container.innerHTML =
          '<div class="loading"><div class="spinner"></div>Müsait saatler yükleniyor...</div>';

        try {
          const response = await fetch(
            `/api/available-times/${selectedData.doctor.id}/${selectedData.date}`
          );
          const availableTimes = await response.json();

          container.innerHTML = availableTimes
            .map(
              (timeSlot) => `
            <div class="time-slot ${!timeSlot.available ? "unavailable" : ""}" 
                 onclick="${
                   !timeSlot.available ? "" : `selectTime('${timeSlot.time}')`
                 }">
                ${timeSlot.time}
            </div>
        `
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<div class="loading">Saatler yüklenirken hata oluştu. Lütfen tekrar deneyin.</div>';
          console.error("Time slots loading error:", error);
        }
      }
      function selectTime(time) {
        selectedData.time = time;
        document
          .querySelectorAll(".time-slot")
          .forEach((slot) => slot.classList.remove("selected"));
        event.target.classList.add("selected");
      }

      function renderSummary() {
        const container = document.getElementById("summaryCard");
        const date = new Date(selectedData.date);
        const formattedDate = date.toLocaleDateString("tr-TR", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        container.innerHTML = `
                                  <div class="summary-item">
                                      <div class="summary-label">Poliklinik:</div>
                                      <div class="summary-value">${selectedData.department.name}</div>
                                  </div>
                                  <div class="summary-item">
                                      <div class="summary-label">Hastane:</div>
                                      <div class="summary-value">${selectedData.hospital.name}</div>
                                  </div>
                                  <div class="summary-item">
                                      <div class="summary-label">Doktor:</div>
                                      <div class="summary-value">${selectedData.doctor.name}</div>
                                  </div>
                                  <div class="summary-item">
                                      <div class="summary-label">Tarih:</div>
                                      <div class="summary-value">${formattedDate}</div>
                                  </div>
                                  <div class="summary-item">
                                      <div class="summary-label">Saat:</div>
                                      <div class="summary-value">${selectedData.time}</div>
                                  </div>
                              `;
      }

      async function nextStep() {
        if (currentStep === 1 && !selectedData.department.id) {
          alert("Lütfen bir poliklinik seçiniz.");
          return;
        }
        if (currentStep === 2 && !selectedData.hospital.id) {
          alert("Lütfen bir hastane seçiniz.");
          return;
        }
        if (currentStep === 3 && !selectedData.doctor.id) {
          alert("Lütfen bir doktor seçiniz.");
          return;
        }
        if (currentStep === 4 && (!selectedData.date || !selectedData.time)) {
          alert("Lütfen tarih ve saat seçiniz.");
          return;
        }

        // Buton loading durumu
        const nextBtn = document.getElementById("nextBtn");
        const originalText = nextBtn.innerHTML;
        nextBtn.innerHTML =
          '<div class="spinner" style="width: 16px; height: 16px; border-width: 2px; margin: 0 auto;"></div>';
        nextBtn.disabled = true;

        try {
          currentStep++;
          updateStepIndicator();
          showCurrentSection();

          // Her adımda ilgili verileri yükle
          if (currentStep === 2) {
            await renderHospitals();
          } else if (currentStep === 3) {
            await renderDoctors();
          } else if (currentStep === 4) {
            renderDatePicker();
          } else if (currentStep === 5) {
            renderSummary();
            nextBtn.style.display = "none";
          }

          // Önceki butonu göster
          if (currentStep > 1) {
            document.getElementById("prevBtn").style.display = "block";
          }
        } catch (error) {
          console.error("Step loading error:", error);
          alert("Bir hata oluştu. Lütfen tekrar deneyin.");
          currentStep--; // Geri al
          updateStepIndicator();
          showCurrentSection();
        } finally {
          // Buton durumunu geri al
          if (currentStep !== 5) {
            nextBtn.innerHTML = originalText;
            nextBtn.disabled = false;
          }
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          currentStep--;
          updateStepIndicator();
          showCurrentSection();

          // Devam et butonunu tekrar göster
          document.getElementById("nextBtn").style.display = "block";

          // İlk adımda önceki butonu gizle
          if (currentStep === 1) {
            document.getElementById("prevBtn").style.display = "none";
          }
        }
      }

      function updateStepIndicator() {
        for (let i = 1; i <= 5; i++) {
          const step = document.getElementById(`step${i}`);
          if (i < currentStep) {
            step.className = "step completed";
          } else if (i === currentStep) {
            step.className = "step active";
          } else {
            step.className = "step inactive";
          }
        }
      }

      function showCurrentSection() {
        for (let i = 1; i <= 5; i++) {
          const section = document.getElementById(`section${i}`);
          if (i === currentStep) {
            section.classList.add("active");
          } else {
            section.classList.remove("active");
          }
        }
      }

      async function confirmAppointment() {
        const confirmBtn = document.querySelector(".confirm-btn");
        const originalText = confirmBtn.innerHTML;

        // Button loading durumu
        confirmBtn.innerHTML = "⏳ Randevu oluşturuluyor...";
        confirmBtn.disabled = true;

        try {
          // API'ye randevu verisini gönder
          const appointmentData = {
            patient_name: "Hasta", // Buraya gerçek hasta adı gelecek
            department_id: selectedData.department.id,
            hospital_id: selectedData.hospital.id,
            doctor_id: selectedData.doctor.id,
            appointment_date: selectedData.date,
            appointment_time: selectedData.time,
          };

          const response = await fetch("/api/create-appointment", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(appointmentData),
          });

          const result = await response.json();

          if (result.success) {
            // Başarı durumu
            const date = new Date(selectedData.date);
            const formattedDate = date.toLocaleDateString("tr-TR", {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric",
            });

            const confirmMessage = `
🎉 Randevunuz başarıyla alındı!

📋 Randevu Detayları:
- Randevu No: ${result.appointment_id}
- Poliklinik: ${selectedData.department.name}
- Hastane: ${selectedData.hospital.name}
- Doktor: ${selectedData.doctor.name}
- Tarih: ${formattedDate}
- Saat: ${selectedData.time}

📱 SMS ile randevu hatırlatması gönderilecektir.
📧 E-posta onay bilgisi iletilmiştir.

Randevunuza 15 dakika önce hastanede bulunmanız önerilir.
            `;

            alert(confirmMessage);

            // Başarı animasyonu
            confirmBtn.innerHTML = "✅ Randevu Alındı!";
            confirmBtn.style.background = "#27ae60";

            // 3 saniye sonra ana sayfaya yönlendir
            setTimeout(() => {
              // Ana sayfaya yönlendir (gerçek URL'yi yazın)
              window.location.href = "/"; // veya ana sayfa URL'niz
            }, 3000);
          } else {
            throw new Error(result.message || "Randevu oluşturulamadı");
          }
        } catch (error) {
          console.error("Appointment creation error:", error);

          // Hata durumu
          alert(
            "❌ Randevu oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.\n\nHata: " +
              error.message
          );

          // Button'u eski haline döndür
          confirmBtn.innerHTML = originalText;
          confirmBtn.disabled = false;
          confirmBtn.style.background =
            "linear-gradient(135deg, #27ae60 0%, #229954 100%)";
        }
      }
      // Sayfa yüklendiğinde başlat
      document.addEventListener("DOMContentLoaded", async function () {
        await initializePage();

        // Kartlara animasyon ekle
        setTimeout(() => {
          const cards = document.querySelectorAll(".department-card");
          cards.forEach((card, index) => {
            card.style.opacity = "0";
            card.style.transform = "translateY(20px)";
            card.style.transition = "all 0.5s ease";

            setTimeout(() => {
              card.style.opacity = "1";
              card.style.transform = "translateY(0)";
            }, index * 100);
          });
        }, 100);
      });
      // Global loading yardımcı fonksiyonları
      function showLoading(container, message = "Yükleniyor...") {
        if (typeof container === "string") {
          container = document.getElementById(container);
        }
        container.innerHTML = `
        <div class="loading">
            <div class="spinner"></div>
            ${message}
        </div>
    `;
      }

      function showError(
        container,
        message = "Bir hata oluştu. Lütfen tekrar deneyin."
      ) {
        if (typeof container === "string") {
          container = document.getElementById(container);
        }
        container.innerHTML = `
        <div class="loading" style="color: #e74c3c;">
            <div style="font-size: 24px; margin-bottom: 10px;">⚠️</div>
            ${message}
        </div>
    `;
      }

      function showEmpty(container, message = "Veri bulunamadı.", icon = "📭") {
        if (typeof container === "string") {
          container = document.getElementById(container);
        }
        container.innerHTML = `
        <div class="loading">
            <div style="font-size: 48px; margin-bottom: 15px;">${icon}</div>
            <h3>${message}</h3>
        </div>
    `;
      }
    </script>
  </body>
</html>
