<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tahlil Sonu√ßlarƒ± - Medvice</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 100%;
        margin: 0;
        background: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        padding: 20px 25px;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
      }

      .header-title {
        flex: 1;
        font-size: 18px;
        font-weight: 600;
      }

      .content {
        flex: 1;
        padding: 25px;
        overflow-y: auto;
      }

      .summary-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 25px;
        border-left: 4px solid #3498db;
      }

      .summary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .summary-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }

      .last-update {
        font-size: 12px;
        color: #666;
      }

      .summary-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }

      .stat-item {
        text-align: center;
        padding: 10px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .stat-value {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .normal {
        color: #27ae60;
      }
      .warning {
        color: #f39c12;
      }
      .critical {
        color: #e74c3c;
      }

      .tests-section {
        margin-bottom: 25px;
      }

      .section-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .test-card {
        background: white;
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 15px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
      }

      .test-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.12);
      }

      .test-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 12px;
      }

      .test-name {
        font-weight: 600;
        font-size: 14px;
        color: #333;
        flex: 1;
      }

      .test-date {
        font-size: 12px;
        color: #666;
      }

      .test-results {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
      }

      .result-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 8px;
        text-align: center;
        border-left: 3px solid #dee2e6;
      }

      .result-item.normal {
        border-left-color: #27ae60;
      }
      .result-item.warning {
        border-left-color: #f39c12;
      }
      .result-item.critical {
        border-left-color: #e74c3c;
      }

      .result-label {
        font-size: 11px;
        color: #666;
        margin-bottom: 4px;
      }

      .result-value {
        font-size: 14px;
        font-weight: bold;
        color: #333;
      }

      .result-unit {
        font-size: 11px;
        color: #666;
        margin-left: 2px;
      }

      .result-range {
        font-size: 10px;
        color: #999;
        margin-top: 2px;
      }

      .status-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
        margin-top: 4px;
      }

      .badge-normal {
        background: #d5f4e6;
        color: #0f5132;
      }

      .badge-warning {
        background: #fff3cd;
        color: #664d03;
      }

      .badge-critical {
        background: #f8d7da;
        color: #721c24;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }

      .btn-secondary {
        background: #f8f9fa;
        color: #666;
        border: 1px solid #e9ecef;
      }

      .btn:hover {
        transform: translateY(-1px);
      }

      .trend-indicator {
        font-size: 12px;
        margin-left: 5px;
      }

      .trend-up {
        color: #e74c3c;
      }
      .trend-down {
        color: #27ae60;
      }
      .trend-stable {
        color: #95a5a6;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="back-btn" onclick="history.back()">‚Üê</button>
        <div class="header-title">
          Tahlil Sonu√ßlarƒ± - {{ session['user']['name'] }}
        </div>
        <div>üìã</div>
      </div>

      <div class="content">
        <div class="summary-card">
          <div class="summary-header">
            <div class="summary-title">üìä Genel Durum</div>
            <div class="last-update">Son g√ºncelleme: 24.07.2025</div>
          </div>
          <div class="summary-stats">
            <div class="stat-item">
              <div class="stat-value normal">8</div>
              <div class="stat-label">Normal</div>
            </div>
            <div class="stat-item">
              <div class="stat-value warning">2</div>
              <div class="stat-label">Dikkat</div>
            </div>
            <div class="stat-item">
              <div class="stat-value critical">1</div>
              <div class="stat-label">Kritik</div>
            </div>
          </div>
        </div>

        <div class="tests-section">
          <div class="section-title">ü©∏ Kan Tahlilleri</div>

          {% set grouped = {} %} {% for result in lab_results %} {% if
          result.test_type not in grouped %} {% set _ =
          grouped.update({result.test_type: []}) %} {% endif %} {% set _ =
          grouped[result.test_type].append(result) %} {% endfor %} {% for
          test_type, tests in grouped.items() %}
          <div class="test-card">
            <div class="test-header">
              <div class="test-name">{{ test_type }}</div>
              <div class="test-date">{{ tests[0].test_date }}</div>
            </div>
            <div class="test-results">
              {% for test in tests %}
              <div
                class="result-item {% if test.status == 'normal' %}normal{% elif test.status == 'warning' %}warning{% elif test.status == 'critical' %}critical{% else %}normal{% endif %}"
              >
                <div class="result-label">{{ test.test_name }}</div>
                <div class="result-value">
                  {{ test.value }}
                  <span class="result-unit">{{ test.unit }}</span>
                </div>
                <div class="result-range">Normal: {{ test.range_info }}</div>
                <span
                  class="status-badge {% if test.status == 'normal' %}badge-normal {% elif test.status == 'warning' %}badge-warning {% elif test.status == 'critical' %}badge-critical {% else %}badge-normal{% endif %}"
                >
                  {% if test.status == 'normal' %}Normal {% elif test.status ==
                  'warning' %}Y√ºksek ‚¨ÜÔ∏è {% elif test.status == 'critical' %}√áok
                  Y√ºksek ‚¨ÜÔ∏è {% else %}Bilinmiyor{% endif %}
                </span>
              </div>
              {% endfor %}
            </div>
            <div class="action-buttons">
              <button
                class="btn btn-primary"
                onclick="downloadReport(test_type )"
              >
                üìÑ Raporu ƒ∞ndir
              </button>
              <button
                class="btn btn-secondary"
                onclick="shareResult(test_type )"
              >
                üì§ Payla≈ü
              </button>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="tests-section">
          <div class="section-title">üß™ T√ºm Testler</div>

          {% for test in lab_results %}
          <div class="test-card">
            <div class="test-header">
              <div class="test-name">
                {{ test.test_type }} - {{ test.test_name }}
              </div>
              <div class="test-date">{{ test.test_date }}</div>
            </div>
            <div class="test-results">
              <div
                class="result-item {% if test.status == 'Normal' %}normal{% elif test.status == 'Dikkat' %}warning{% elif test.status == 'Kritik' %}critical{% endif %}"
              >
                <div class="result-label">{{ test.test_name }}</div>
                <div class="result-value">
                  {{ test.value }}
                  <span class="result-unit">{{ test.unit }}</span>
                </div>
                <div class="result-range">{{ test.range_info }}</div>
                <span
                  class="status-badge {% if test.status == 'Normal' %}badge-normal {% elif test.status == 'Dikkat' %}badge-warning {% elif test.status == 'Kritik' %}badge-critical {% endif %}"
                >
                  {{ test.status }}
                </span>
              </div>
            </div>
            <div class="action-buttons">
              <button
                class="btn btn-primary"
                onclick="downloadReport('{{ test.test_name }}')"
              >
                üìÑ Raporu ƒ∞ndir
              </button>
              <button
                class="btn btn-secondary"
                onclick="shareResult('{{ test.test_name }}')"
              >
                üì§ Payla≈ü
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <script>
      function downloadReport(testType) {
        const testNames = {
          hemogram: "Hemogram Raporu",
          biochemistry: "Biyokimya Raporu",
          thyroid: "Tiroid Raporu",
          vitamins: "Vitamin-Mineral Raporu",
        };

        alert(`üìÑ ${testNames[testType]} PDF olarak indiriliyor...`);

        // Sim√ºlasyon - ger√ßek uygulamada PDF olu≈üturulur
        setTimeout(() => {
          alert(`‚úÖ ${testNames[testType]} ba≈üarƒ±yla indirildi!`);
        }, 1500);
      }

      function shareResult(testType) {
        const testNames = {
          hemogram: "Hemogram Sonu√ßlarƒ±",
          biochemistry: "Biyokimya Sonu√ßlarƒ±",
          thyroid: "Tiroid Sonu√ßlarƒ±",
          vitamins: "Vitamin-Mineral Sonu√ßlarƒ±",
        };

        if (
          confirm(
            `üì§ ${testNames[testType]}'nƒ± doktorunuzla payla≈ümak istediƒüinizden emin misiniz?`
          )
        ) {
          alert(`‚úÖ ${testNames[testType]} g√ºvenli baƒülantƒ± ile payla≈üƒ±ldƒ±!`);
        }
      }

      // Sayfa y√ºklendiƒüinde animasyon efekti
      document.addEventListener("DOMContentLoaded", function () {
        const cards = document.querySelectorAll(".test-card");
        cards.forEach((card, index) => {
          setTimeout(() => {
            card.style.opacity = "0";
            card.style.transform = "translateY(20px)";
            card.style.transition = "all 0.5s ease";

            setTimeout(() => {
              card.style.opacity = "1";
              card.style.transform = "translateY(0)";
            }, 100);
          }, index * 200);
        });
      });
    </script>
  </body>
</html>
